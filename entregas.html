<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Entregas</title>
</head>
<body>
  <h2>Registro de Entregas de Volantes</h2>
  
  <label for="usuario">Nombre del repartidor:</label>
  <input type="text" id="usuario" placeholder="Escribe tu nombre"><br><br>
  
  <button onclick="registrarEntrega()">Registrar entrega</button>

  <p id="estado"></p>

  <script>
    async function registrarEntrega() {
      const estado = document.getElementById("estado");
      const usuario = document.getElementById("usuario").value.trim();

      if (!usuario) {
        estado.innerText = "Por favor, escribe tu nombre.";
        return;
      }

      estado.innerText = "Obteniendo ubicación…";

      if (!navigator.geolocation) {
        estado.innerText = "Tu navegador no permite geolocalización.";
        return;
      }

      navigator.geolocation.getCurrentPosition(async function(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const data = {
          usuario: usuario,
          latitud: lat,
          longitud: lng,
          direccion: "",        // Puedes añadir lógica futura para esto
          imagenURL: ""         // También puedes agregar esta opción en el futuro
        };

        try {
          const respuesta = await fetch("https://script.google.com/macros/s/AKfycbwNQrAkoqwDYRsxUR4ZbmNTjiX2QJ90PcEPH5L4Qd-JPy4p9p6ZxNcULijeqJSs9L3r/exec", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
          });

          if (respuesta.ok) {
            estado.innerText = "✅ Entrega registrada con éxito";
          } else {
            estado.innerText = "❌ Error al registrar. Código: " + respuesta.status;
          }
        } catch (error) {
          estado.innerText = "❌ Error al conectar con el servidor.";
        }

      }, function(error) {
        estado.innerText = "No se pudo obtener la ubicación. Activa el GPS.";
      });
    }
  </script>
</body>
</html>
